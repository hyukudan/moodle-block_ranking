/**
 * Ranking block AMD module.
 *
 * Provides auto-refresh polling for ranking data and smooth animations.
 *
 * @module     block_ranking/ranking
 * @package    block_ranking
 * @copyright  2024 block_ranking contributors
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["jquery","core/ajax","core/notification"],(function(n,e,t){var i=6e4,r=null;function a(){r&&(clearInterval(r),r=null)}function o(i){e.call([{methodname:"block_ranking_get_ranking",args:{courseids:[i]}}])[0].done((function(e){e&&e.leaderboard&&function(e){var t=n('[data-ranking-type="general"]');if(!t.length||!e.length)return;var i=t.find(".ranking-item"),r=!1;i.each((function(t){if(t<e.length){var i=n(this),a=e[t].points;parseFloat(i.find(".ranking-points").text())!==a&&(r=!0,i.find(".ranking-points").text(a),i.addClass("ranking-updated"),setTimeout((function(){i.removeClass("ranking-updated")}),1500))}})),r&&(t.closest(".block_ranking").addClass("ranking-refreshed"),setTimeout((function(){t.closest(".block_ranking").removeClass("ranking-refreshed")}),1e3))}(e.leaderboard)})).fail((function(n){t.exception(n),a()}))}return{init:function(n,e){e&&(i=e),n&&i>0&&function(n){document.addEventListener("visibilitychange",(function(){document.hidden?a():r=setInterval((function(){o(n)}),i)})),r=setInterval((function(){o(n)}),i)}(n),function(){if("IntersectionObserver"in window){var n=new IntersectionObserver((function(e){e.forEach((function(e){e.isIntersecting&&(e.target.classList.add("ranking-visible"),n.unobserve(e.target))}))}),{threshold:.1});document.querySelectorAll(".ranking-item").forEach((function(e){n.observe(e)}))}}()}}}));